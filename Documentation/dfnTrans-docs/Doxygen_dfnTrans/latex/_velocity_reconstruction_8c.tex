\hypertarget{_velocity_reconstruction_8c}{}\section{Docs\+\_\+\+P\+T/\+Particle\+Tracking\+\_\+source/\+Velocity\+Reconstruction.c File Reference}
\label{_velocity_reconstruction_8c}\index{Docs\_PT/ParticleTracking\_source/VelocityReconstruction.c@{Docs\_PT/ParticleTracking\_source/VelocityReconstruction.c}}
{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$search.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include $<$math.\+h$>$}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include \char`\"{}Func\+Def.\+h\char`\"{}}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{structlb}{lb}}
\item 
struct \mbox{\hyperlink{structmatr}{matr}}
\item 
struct \mbox{\hyperlink{structinpfile}{inpfile}}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{_velocity_reconstruction_8c_a6c0b7207a055a56ec2091b578dcab307}{Darcy\+Velocity}} ()
\item 
void \mbox{\hyperlink{_velocity_reconstruction_8c_ae95808a34380ac01e823c78d8a708eb3}{Output\+Velocities}} ()
\item 
struct \mbox{\hyperlink{structmatr}{matr}} \mbox{\hyperlink{_velocity_reconstruction_8c_a9847c8edcfa5f9fd5426106a7477f935}{Matrix\+Products}} (double normxarea\mbox{[}$\,$\mbox{]}\mbox{[}2\mbox{]}, int number)
\item 
struct \mbox{\hyperlink{structlb}{lb}} \mbox{\hyperlink{_velocity_reconstruction_8c_acc3803bef1f2fcc10f4f2a0ecc627b34}{Define\+Boundary\+Angle}} (int i, unsigned int edge\+\_\+1, unsigned int edge\+\_\+2, int f1, int coorf)
\item 
double \mbox{\hyperlink{_velocity_reconstruction_8c_a3759fb98594fea9a5c180b9d2324e027}{Define\+Angle}} (double u1, double u2, double v1, double v2)
\item 
void \mbox{\hyperlink{_velocity_reconstruction_8c_a4b5dc793aa9d2613949a5134c379e606}{Velocity\+Interior\+Node}} (double normx\+\_\+area\mbox{[}$\,$\mbox{]}\mbox{[}2\mbox{]}, int i, int number, unsigned int indj\mbox{[}\mbox{\hyperlink{main_8c_a9bbb8dd86b166646cdce87a545a36fa7}{max\+\_\+neighb}}\mbox{]}, int vi)
\item 
void \mbox{\hyperlink{_velocity_reconstruction_8c_adb7186f480640c540eec15220968f12d}{Velocity\+Exterior\+Node}} (double norm\+\_\+xarea\mbox{[}$\,$\mbox{]}\mbox{[}2\mbox{]}, int i, int number, unsigned int indj\mbox{[}\mbox{\hyperlink{main_8c_a9bbb8dd86b166646cdce87a545a36fa7}{max\+\_\+neighb}}\mbox{]}, struct \mbox{\hyperlink{structlb}{lb}} lbound, int vi)
\item 
void \mbox{\hyperlink{_velocity_reconstruction_8c_a638a294e89812e3847446ff830b717f9}{Boundary\+Cells}} ()
\item 
int \mbox{\hyperlink{_velocity_reconstruction_8c_a54da61c82947f6b18230d9d49a15d3b5}{Corner\+Velocity}} (int i, int m1, int m2, int m3, int s1, int s2, int s3)
\item 
int \mbox{\hyperlink{_velocity_reconstruction_8c_a5445e2c235239b89cc51146de36ca58f}{XindexC}} (int nodenum, int ii)
\item 
int \mbox{\hyperlink{_velocity_reconstruction_8c_a11a6fda3ecb0ede2c4a9a8e96e23145d}{YindexC}} (int nodenum, int ii)
\item 
void \mbox{\hyperlink{_velocity_reconstruction_8c_a0210252e558723368a0288b57b6136ea}{Half\+Polygon\+Velocity}} (int i, int k, int fractn, int indc, unsigned int fractj\mbox{[}\mbox{\hyperlink{main_8c_a9bbb8dd86b166646cdce87a545a36fa7}{max\+\_\+neighb}}\mbox{]})
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\mbox{\Hypertarget{_velocity_reconstruction_8c_a638a294e89812e3847446ff830b717f9}\label{_velocity_reconstruction_8c_a638a294e89812e3847446ff830b717f9}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!BoundaryCells@{BoundaryCells}}
\index{BoundaryCells@{BoundaryCells}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{BoundaryCells()}{BoundaryCells()}}
{\footnotesize\ttfamily void Boundary\+Cells (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

The function checks velocities at boundary nodes and fixes pathological cases.

In the rare event, when two velocity vectors are directed towards each other along the same cell edge, a particle will be stuck there. To avoid this situation, one of velocities is redirected along the edge with node associated with lower pressure value. 

Definition at line 531 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a54da61c82947f6b18230d9d49a15d3b5}\label{_velocity_reconstruction_8c_a54da61c82947f6b18230d9d49a15d3b5}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!CornerVelocity@{CornerVelocity}}
\index{CornerVelocity@{CornerVelocity}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{CornerVelocity()}{CornerVelocity()}}
{\footnotesize\ttfamily int Corner\+Velocity (\begin{DoxyParamCaption}\item[{int}]{i,  }\item[{int}]{m1,  }\item[{int}]{m2,  }\item[{int}]{m3,  }\item[{int}]{s1,  }\item[{int}]{s2,  }\item[{int}]{s3 }\end{DoxyParamCaption})}

The Function identifies pathologycal cases at corner of fracture boundary. The angle between velocity on corner node and velocities/edges on surrounding boundary nodes are calculated. Then, if velocity is pointing outside of fracture, turns the velocity direction along the fracture edge. 

Definition at line 771 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a6c0b7207a055a56ec2091b578dcab307}\label{_velocity_reconstruction_8c_a6c0b7207a055a56ec2091b578dcab307}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!DarcyVelocity@{DarcyVelocity}}
\index{DarcyVelocity@{DarcyVelocity}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{DarcyVelocity()}{DarcyVelocity()}}
{\footnotesize\ttfamily void Darcy\+Velocity (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Function performs Darcy\textquotesingle{}s velocity reconstruction (main function of Darcy velocities reconstruction procedure) using linear least square algorithm. Flow solver provides flow fluxes on each edge of control volume cells. Velocity on each control volume cell center (each node) is reconstructed using flow fluxes.

Velocity of interior and interior-\/interface nodes is reconstructed according to Eq.\+5 (Painter,2011); exterior node\textquotesingle{} velocity according to Eq.\+7 (Painter, 2011)

Function makes a loop over all nodes and calls functions for velocity reconstruction depending of type of the node (external, internal, internal-\/interface, external interface) 

Definition at line 29 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a3759fb98594fea9a5c180b9d2324e027}\label{_velocity_reconstruction_8c_a3759fb98594fea9a5c180b9d2324e027}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!DefineAngle@{DefineAngle}}
\index{DefineAngle@{DefineAngle}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{DefineAngle()}{DefineAngle()}}
{\footnotesize\ttfamily double Define\+Angle (\begin{DoxyParamCaption}\item[{double}]{u1,  }\item[{double}]{u2,  }\item[{double}]{v1,  }\item[{double}]{v2 }\end{DoxyParamCaption})}

Function defines an angle between two edges of voronoy cell 

Definition at line 415 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_acc3803bef1f2fcc10f4f2a0ecc627b34}\label{_velocity_reconstruction_8c_acc3803bef1f2fcc10f4f2a0ecc627b34}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!DefineBoundaryAngle@{DefineBoundaryAngle}}
\index{DefineBoundaryAngle@{DefineBoundaryAngle}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{DefineBoundaryAngle()}{DefineBoundaryAngle()}}
{\footnotesize\ttfamily struct \mbox{\hyperlink{structlb}{lb}} Define\+Boundary\+Angle (\begin{DoxyParamCaption}\item[{int}]{i,  }\item[{unsigned int}]{edge\+\_\+1,  }\item[{unsigned int}]{edge\+\_\+2,  }\item[{int}]{f1,  }\item[{int}]{coorf }\end{DoxyParamCaption})}

The function defines angle between two edges of a boundary cell and return the result. The angle is used in flow velocity reconstruction on fracture edge. 

Definition at line 367 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a0210252e558723368a0288b57b6136ea}\label{_velocity_reconstruction_8c_a0210252e558723368a0288b57b6136ea}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!HalfPolygonVelocity@{HalfPolygonVelocity}}
\index{HalfPolygonVelocity@{HalfPolygonVelocity}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{HalfPolygonVelocity()}{HalfPolygonVelocity()}}
{\footnotesize\ttfamily void Half\+Polygon\+Velocity (\begin{DoxyParamCaption}\item[{int}]{i,  }\item[{int}]{k,  }\item[{int}]{fractn,  }\item[{int}]{indc,  }\item[{unsigned int}]{fractj\mbox{[}max\+\_\+neighb\mbox{]} }\end{DoxyParamCaption})}

Velocity reconstruction on an intersection node. In this case, the control volume cell is devided onto two polygons by intersection line. The velocity reconstruction is performed on each part of control volume cell at intersection. 

Definition at line 944 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a9847c8edcfa5f9fd5426106a7477f935}\label{_velocity_reconstruction_8c_a9847c8edcfa5f9fd5426106a7477f935}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!MatrixProducts@{MatrixProducts}}
\index{MatrixProducts@{MatrixProducts}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{MatrixProducts()}{MatrixProducts()}}
{\footnotesize\ttfamily struct \mbox{\hyperlink{structmatr}{matr}} Matrix\+Products (\begin{DoxyParamCaption}\item[{double}]{normxarea\mbox{[}$\,$\mbox{]}\mbox{[}2\mbox{]},  }\item[{int}]{number }\end{DoxyParamCaption})}

Function performs matrix dot product (G\+TG)-\/1 and returns the result. 

Definition at line 318 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_ae95808a34380ac01e823c78d8a708eb3}\label{_velocity_reconstruction_8c_ae95808a34380ac01e823c78d8a708eb3}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!OutputVelocities@{OutputVelocities}}
\index{OutputVelocities@{OutputVelocities}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{OutputVelocities()}{OutputVelocities()}}
{\footnotesize\ttfamily void Output\+Velocities (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

This function is called to output velocities on nodes in the order of fractture I\+Ds. The output can be used to visualise flow field of 2D reconstructed Darcy velocities in 3D simulation domain 

Definition at line 253 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_adb7186f480640c540eec15220968f12d}\label{_velocity_reconstruction_8c_adb7186f480640c540eec15220968f12d}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!VelocityExteriorNode@{VelocityExteriorNode}}
\index{VelocityExteriorNode@{VelocityExteriorNode}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{VelocityExteriorNode()}{VelocityExteriorNode()}}
{\footnotesize\ttfamily void Velocity\+Exterior\+Node (\begin{DoxyParamCaption}\item[{double}]{norm\+\_\+xarea\mbox{[}$\,$\mbox{]}\mbox{[}2\mbox{]},  }\item[{int}]{i,  }\item[{int}]{number,  }\item[{unsigned int}]{indj\mbox{[}max\+\_\+neighb\mbox{]},  }\item[{struct \mbox{\hyperlink{structlb}{lb}}}]{lbound,  }\item[{int}]{vi }\end{DoxyParamCaption})}

The function reconstructs Darcy velocity on exterior (boundary) node 

Definition at line 465 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a4b5dc793aa9d2613949a5134c379e606}\label{_velocity_reconstruction_8c_a4b5dc793aa9d2613949a5134c379e606}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!VelocityInteriorNode@{VelocityInteriorNode}}
\index{VelocityInteriorNode@{VelocityInteriorNode}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{VelocityInteriorNode()}{VelocityInteriorNode()}}
{\footnotesize\ttfamily void Velocity\+Interior\+Node (\begin{DoxyParamCaption}\item[{double}]{normx\+\_\+area\mbox{[}$\,$\mbox{]}\mbox{[}2\mbox{]},  }\item[{int}]{i,  }\item[{int}]{number,  }\item[{unsigned int}]{indj\mbox{[}max\+\_\+neighb\mbox{]},  }\item[{int}]{vi }\end{DoxyParamCaption})}

The function reconstructs Darcy velocity on interior cell center, at interior node 

Definition at line 426 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a5445e2c235239b89cc51146de36ca58f}\label{_velocity_reconstruction_8c_a5445e2c235239b89cc51146de36ca58f}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!XindexC@{XindexC}}
\index{XindexC@{XindexC}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{XindexC()}{XindexC()}}
{\footnotesize\ttfamily int XindexC (\begin{DoxyParamCaption}\item[{int}]{nodenum,  }\item[{int}]{ii }\end{DoxyParamCaption})}

Functions returns the index of X coordination of intersection node (cells) 

Definition at line 922 of file Velocity\+Reconstruction.\+c.

\mbox{\Hypertarget{_velocity_reconstruction_8c_a11a6fda3ecb0ede2c4a9a8e96e23145d}\label{_velocity_reconstruction_8c_a11a6fda3ecb0ede2c4a9a8e96e23145d}} 
\index{VelocityReconstruction.c@{VelocityReconstruction.c}!YindexC@{YindexC}}
\index{YindexC@{YindexC}!VelocityReconstruction.c@{VelocityReconstruction.c}}
\subsubsection{\texorpdfstring{YindexC()}{YindexC()}}
{\footnotesize\ttfamily int YindexC (\begin{DoxyParamCaption}\item[{int}]{nodenum,  }\item[{int}]{ii }\end{DoxyParamCaption})}

Functions returns the index of Y coordination of intersection node (cells) 

Definition at line 933 of file Velocity\+Reconstruction.\+c.

