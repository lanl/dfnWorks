

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Tutorial &mdash; dfnWorks 2.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Example Applications" href="applications.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index_docs.html" class="icon icon-home"> dfnWorks
          

          
            
            <img src="_static/dfnworks_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.1, LANL, Docs: LA-UR-17-22216, Software: LA-CC-17-027
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#turn-on-x-forwarding-if-on-server">Turn on X forwarding if on server</a></li>
<li class="toctree-l2"><a class="reference internal" href="#go-to-the-dnfworks-repository">Go to the dnfWorks repository</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fix-paths-in-test-directory">Fix paths in test directory</a></li>
<li class="toctree-l2"><a class="reference internal" href="#set-the-petsc-pflotran-python-and-lagrit-paths-correctly">Set the PETSC, PFLOTRAN, Python, and LaGriT paths correctly</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setup-the-python-package-pydfnworks">Setup the Python package pydfnworks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#executing-dfnworks">Executing dfnWorks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-defined-rectangles">4_user_defined_rectangles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-defined-ellipses">4_user_defined_ellipses</a></li>
<li class="toctree-l2"><a class="reference internal" href="#truncated-power-law-dist">truncated_power_law_dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exponential-dist">exponential_dist</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lognormal-dist">lognormal_dist</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Example Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">dfnWorks Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="pydfnworks.html">pydfnworks: the dfnWorks python package</a></li>
<li class="toctree-l1"><a class="reference internal" href="dfngen.html">dfnGen</a></li>
<li class="toctree-l1"><a class="reference internal" href="dfnflow.html">dfnFlow</a></li>
<li class="toctree-l1"><a class="reference internal" href="dfntrans.html">dfnTrans</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts.html">Scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output files</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index_docs.html">dfnWorks</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index_docs.html">Docs</a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>This document contains a short, five example, tutorial for dfnWorks. The five test cases provided are for:</p>
<ul class="simple">
<li>4_user_defined_rectangles: The user defines the precise location and size of four rectangular fractures.</li>
<li>4_user_defined_ellipses: The user defines the precise location and size of four elliptical fractures, where the ellipses are approximated as polygons.</li>
<li>exponential_dist: The user specifies the parameters for two families of fractures with an exponential distribution of fracture size.</li>
<li>lognormal_dist: The user specifies the parameters for two families of fractures with a lognormal distribution of fracture size.</li>
<li>truncated_power_law_dist: The user specifies the parameters for two families of fractures with a truncated power-law distribution of fracture size.</li>
</ul>
<p>All required input files for these examples are contained in the folder dfnWorks/tests/. The focus of this document is to provide visual confirmation that new users of dfnWorks have the code set up correctly, can carry out the following runs and reproduce the following images. All images are rendered using Paraview, which can be obtained for free at http : //www.paraview.org/. The first two examples are simpler than the last three so it is recommended that the user proceed in the order presented here.</p>
<div class="section" id="turn-on-x-forwarding-if-on-server">
<h2>Turn on X forwarding if on server<a class="headerlink" href="#turn-on-x-forwarding-if-on-server" title="Permalink to this headline">¶</a></h2>
<p>Ensure that X forwarding is turned on if you are running dfnWorks from an ssh connection. This requires that the ssh login have the -X option:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ssh -X SERVER_NAME
</pre></div>
</div>
</div>
<div class="section" id="go-to-the-dnfworks-repository">
<h2>Go to the dnfWorks repository<a class="headerlink" href="#go-to-the-dnfworks-repository" title="Permalink to this headline">¶</a></h2>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ~/dfnWorks/
</pre></div>
</div>
</div>
<div class="section" id="fix-paths-in-test-directory">
<h2>Fix paths in test directory<a class="headerlink" href="#fix-paths-in-test-directory" title="Permalink to this headline">¶</a></h2>
<p>Fix the pathnames for all files in the folder /tests/ . This can be done automatically by running the script fix_paths.py:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> /pydfnworks/bin/
$ python fix_paths.py
</pre></div>
</div>
</div>
<div class="section" id="set-the-petsc-pflotran-python-and-lagrit-paths-correctly">
<h2>Set the PETSC, PFLOTRAN, Python, and LaGriT paths correctly<a class="headerlink" href="#set-the-petsc-pflotran-python-and-lagrit-paths-correctly" title="Permalink to this headline">¶</a></h2>
<p><strong>Before executing dfnWorks,</strong> the following paths must be set:</p>
<ul class="simple">
<li>dfnWorks_PATH: the dfnWorks repository folder</li>
<li>PETSC_DIR and PETSC_ARCH: PETSC environmental variables</li>
<li>PFLOTRAN_DIR: The PFLOTRAN directory</li>
<li>python_dfn: The location of the Python distribution to use</li>
<li>lagrit_dfn: The location of the LaGriT executable</li>
</ul>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vi /pydfnworks/pydfnworks/paths.py
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;dfnWorks_PATH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/home/username/dfnWorks/&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="setup-the-python-package-pydfnworks">
<h2>Setup the Python package pydfnworks<a class="headerlink" href="#setup-the-python-package-pydfnworks" title="Permalink to this headline">¶</a></h2>
<p>Go up a directory:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> ..
</pre></div>
</div>
<p><strong>If the user has admin privelges</strong>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python setup.py install
</pre></div>
</div>
<p><strong>If the user DOES NOT have admin priveleges</strong>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python setup.py install --user
</pre></div>
</div>
</div>
<div class="section" id="executing-dfnworks">
<h2>Executing dfnWorks<a class="headerlink" href="#executing-dfnworks" title="Permalink to this headline">¶</a></h2>
<p>To run one of the test cases enter the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ python run.py -name <span class="o">[</span>JOBNAME<span class="o">]</span> -input <span class="o">[</span>INPUT_FILE<span class="o">]</span> -ncpu <span class="o">[</span>NUMBER_OF_CPUS<span class="o">]</span>
</pre></div>
</div>
<p>The arguments are:</p>
<ul class="simple">
<li>[JOBNAME]: The name of the run, which is also the absolute path name of the folder which will contain the run’s output.</li>
<li>[INPUT_FILE]: An input file with three lines that have input files for dfnGen, dfnFlow, and dfnTrans, respectively. Any of the files with ending .txt in the directory tests can be used as examples of input files.</li>
<li>[NUMBER_OF_CPUS]: The number of CPUs that the user would like to use for the parralel computation of the meshing and flow solutions.</li>
</ul>
<p>For example, to run the 4_user_defined rectangles test below, on 4 CPUs,  the command line input would be:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="nb">cd</span> bin
$ python run.py -name /home/username/4_user_defined_rectangles
 -input /home/username/dfnWorks/tests/4_user_defined_rectangles.txt
 -ncpu <span class="m">4</span>
</pre></div>
</div>
<p>This command will run the 4_user_defined_rectangles test and create a new folder 4_user_defined_rectangles where all output files will be located. Descriptions of each output file are in the documentation. In the following sections, we provide descriptions of the output you should expect for each of the five examples.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>Here is a quick summary of the steps described above, with commands for the 4_user_defined_rectangles test case. <strong>You MUST edit the paths in paths.py, and change ~ to the location of the repository, for these commands to work! Also, note that the last command should be on one line.</strong></p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ ssh -X SERVER_NAME
$ <span class="nb">cd</span> ~/dfnWorks/pydfnworks/bin/
$ python fix_paths.py
$ vi /pydfnworks/pydfnworks/paths.py
$ <span class="nb">cd</span> ..
$ python setup.py install --user
$ <span class="nb">cd</span> bin
$ python run.py -name /home/username/4_user_defined_rectangles
 -input /home/username/dfnWorks/tests/4_user_defined_rectangles.txt
 -ncpu <span class="m">4</span>
</pre></div>
</div>
</div>
<div class="section" id="user-defined-rectangles">
<h2>4_user_defined_rectangles<a class="headerlink" href="#user-defined-rectangles" title="Permalink to this headline">¶</a></h2>
<p>This test case consists of four user defined rectangular fractures within a a cubic domain with sides of length one meter. The input file specifiying the ellipses is in dfnWorks/tests, and is named define_4_user_rectangles.dat. To run the test on 4 cpus, enter the following command line input:</p>
<p>The network of four fractures, each colored by material ID. The computational mesh is overlaid on the fractures. This image is created by loading the file full_mesh.inp. located in the folder 4_user_defined_rectangles/LaGriT/, into Paraview.</p>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="_images/4_user_rectangles_mesh.png"><img alt="alternate text" src="_images/4_user_rectangles_mesh.png" style="width: 588.6px; height: 255.6px;" /></a>
<p class="caption"><span class="caption-text"><em>The meshed network of four fractures.</em></span></p>
</div>
<p>High pressure (red) Dirichlet boundary conditions are applied on the edge of the single fracture along the boundary x = -0.5, and low pressure (blue) boundary conditions are applied on the edges of the two fractures at the boundary x = 0.5.
This image is created by loading the file 4_user_defined_rectangles/PFLOTRAN/parsed_vtk/dfn_explicit-001.vtk into Paraview.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/4_user_rectangles_pressure.png"><img alt="alternate text" src="_images/4_user_rectangles_pressure.png" style="width: 588.6px; height: 255.6px;" /></a>
<p class="caption"><span class="caption-text"><em>The network of four fractures, colored by pressure solution.</em></span></p>
</div>
<p>Particles are inserted uniformly along the inlet fracture on the left side of the image.
Particles exit the domain through the two horizontal fractures on the right side of the image.
Due to the stochastic nature of the particle tracking algorithm, your pathlines might not be exactly the same as in this image.
Trajectories are colored by the current velocity magnitude of the particle’s velocity.
Trajectories can be visualized by loading the files part_*.inp, in the folder 4_user_rectangles/dfnTrans/trajectories/
We have used the extract surface and tube filters in paraview for visual clarity.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/4_user_rectangles_trace.png"><img alt="alternate text" src="_images/4_user_rectangles_trace.png" style="width: 629.4px; height: 288.0px;" /></a>
<p class="caption"><span class="caption-text"><em>Particle trajectories on the network of four fractures.</em></span></p>
</div>
<p>In the other tests, only a brief description and pictures are provided.</p>
</div>
<div class="section" id="user-defined-ellipses">
<h2>4_user_defined_ellipses<a class="headerlink" href="#user-defined-ellipses" title="Permalink to this headline">¶</a></h2>
<p>This test case consists of four user defined elliptical fractures within a a cubic domain with sides of length one meter. In this case the ellipses are approximated using 5 vertices. The input file specifiying the ellipses is in dfnWorks/tests, and is named define_4_user_ellipses.dat.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/4_user_ellipses_mesh.png"><img alt="alternate text" src="_images/4_user_ellipses_mesh.png" style="width: 588.6px; height: 255.6px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/4_user_ellipses_pressure.png"><img alt="alternate text" src="_images/4_user_ellipses_pressure.png" style="width: 588.6px; height: 255.6px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/4_user_ellipses_trace.png"><img alt="alternate text" src="_images/4_user_ellipses_trace.png" style="width: 629.4px; height: 288.0px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="truncated-power-law-dist">
<h2>truncated_power_law_dist<a class="headerlink" href="#truncated-power-law-dist" title="Permalink to this headline">¶</a></h2>
<p>This test case consists of two families whose sizes have a truncated power law distribution with a minimum size of 0.5m and a maximum size of 50m. The domain size is cubic with an edge length of 4m. The other input parameters can be found in tests/gen_truncated_power_law_dist.dat.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/power_mesh.png"><img alt="alternate text" src="_images/power_mesh.png" style="width: 629.4px; height: 288.0px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/power_pressure.png"><img alt="alternate text" src="_images/power_pressure.png" style="width: 629.4px; height: 288.0px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/power_trace.png"><img alt="alternate text" src="_images/power_trace.png" style="width: 629.4px; height: 288.0px;" /></a>
</div>
</div>
<div class="section" id="exponential-dist">
<h2>exponential_dist<a class="headerlink" href="#exponential-dist" title="Permalink to this headline">¶</a></h2>
<p>This test case consists of a family of fractures whose size is exponentially distributed with a minimum size of 1m and a maximum size of 50m. The domain is cubic with an edge length of 10m. All input parameters for the generator can be found in tests/gen_exponential_dist.dat.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/exp_mesh.png"><img alt="alternate text" src="_images/exp_mesh.png" style="width: 559.8px; height: 377.4px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/exp_pressure.png"><img alt="alternate text" src="_images/exp_pressure.png" style="width: 559.8px; height: 377.4px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/exp_trace.png"><img alt="alternate text" src="_images/exp_trace.png" style="width: 629.4px; height: 303.0px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="lognormal-dist">
<h2>lognormal_dist<a class="headerlink" href="#lognormal-dist" title="Permalink to this headline">¶</a></h2>
<p>This test case consists of two fracture families whose sizes have a lognormal distribution with a minimum size of 0.5m and a maximum size of 50m. The domain size is cubic with an edge length of 10m. All input parameters for the generator can be found in tests/gen_lognormal_dist.dat.</p>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/lognormal_mesh.png"><img alt="alternate text" src="_images/lognormal_mesh.png" style="width: 559.8px; height: 377.4px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/lognormal_pressure.png"><img alt="alternate text" src="_images/lognormal_pressure.png" style="width: 559.8px; height: 377.4px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<div class="figure align-center">
<a class="reference internal image-reference" href="_images/lognormal_trace.png"><img alt="alternate text" src="_images/lognormal_trace.png" style="width: 629.4px; height: 303.0px;" /></a>
</div>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="applications.html" class="btn btn-neutral float-right" title="Example Applications" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, LANL, LA-UR-17-22216.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'2.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>